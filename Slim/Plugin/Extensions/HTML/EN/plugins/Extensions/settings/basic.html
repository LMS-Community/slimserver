[% IF useExtJS; extJsScripts = BLOCK %]
<script TYPE="text/javascript">
	Ext.onReady(function() {
		[% PROCESS jsString id='PLUGIN_EXTENSIONS_WARNING_POPUP' %]
		[% PROCESS jsString id='PLUGIN_EXTENSIONS_WARNING_POPUP2' %]

		Settings.Page.submit = function(ajax, cb) {
			var items = Ext.query('input.unsafePlugin');
			var msg   = '';
		
			for (var i = 0; i < items.length; i++) {
				if (items[i].checked)
					msg += '<li>' + items[i].value + '</li>';
			}

			// display warning if user wants to install "unsafe" plugins from 3rd party repositories
			if (msg > '') {
				Ext.Msg.show({
					title: SqueezeJS.string('settings'),
					msg: SqueezeJS.string('plugin_extensions_warning_popup') 
							+ '<ul>' + msg + '</ul>' 
							+ SqueezeJS.string('plugin_extensions_warning_popup2'),
					width: 450,
					closable: false,
					buttons: Ext.Msg.OKCANCEL,
					fn: function(btn) {
						if (btn == 'ok') {
							document.forms.settingsForm.submit();
						}
					}
				});
			}
			
			else {
				document.forms.settingsForm.submit();
			}
		};
		
		if (Ext.isIE6)
			return;
			
		var sortableTables = Ext.query('table.sortable');
		
		for (var i = 0; i < sortableTables.length; i++) {	
		    // make the table sortable by header
		    var grid = new SqueezeJS.UI.SortableTable(sortableTables[i]);
		    grid.render();
		}
	});
</script>
[% END; END %]
[% BLOCK pluginGroup %]
	<div class="settingSection" style="margin-top:0;margin-bottom:20px">
		<table class="sortable" width="100%">
			<thead><tr>
				<th width="5%">[% checkHeading | getstring %]&nbsp;</th>
				<th width="15%" class="sortable">[% "NAME" | string %]</th>
				<th width="10%" class="sortable">[% "INFORMATION_VERSION" | string %][% "COLON" | string %]</th>
				<th width="45%" class="sortable">[% "DESCRIPTION" | string %][% "COLON" | string %]</th>
				<th width="15%" class="sortable">[% "PLUGIN_EXTENSIONS_AUTHOR" | string %]</th>
				<th width="10%" class="sortable">&nbsp;</th>
			</tr></thead>
			<tbody>
			[% content %]
			</tbody>
		</table>
	</div>
[% END %]
[% BLOCK pluginDetails %]
	<tr>
		<td><input name="[% plugin.action || "install" %]" 
			[% plugin.action == 'disabled' ? "disabled=disabled checked=checked" : "" %] 
			value="[% plugin.name %]:[% IF plugin.action == 'remove' %][% plugin.current %]:[% plugin.title %][% ELSE %][% plugin.version %][% END %]"
			[% IF type AND type != 'logitech' %]class="unsafePlugin"[% END %] 
			type="checkbox" />
			&nbsp;
		</td>
		<td>[% plugin.title %]&nbsp;</td>
		<td>[% plugin.delta || plugin.version || plugin.current %]&nbsp;</td>
		<td>[% (plugin.changes|| plugin.message || plugin.desc || plugin.title) | html_line_break %]&nbsp;</td>
		<td>
			<span style="display:none">[% plugin.creator || plugin.email %]&nbsp;</span>
			[% IF plugin.email %]<a href="mailto:[% plugin.email %]">[%- END -%][% plugin.creator || plugin.email %][% IF plugin.email %]</a>[%- END -%]&nbsp;
		</td>
		<td>[% IF plugin.link %]<a href="[% plugin.link %]" target="plugin_desc">[% "MOREINFO" | string %]</a>[%- END -%]&nbsp;</td>
	</tr>
[% END %]
[% PROCESS settings/header.html %]

	[% WRAPPER setting title="PLUGIN_EXTENSIONS" desc=(repos.size > 1 ? "PLUGIN_EXTENSIONS_DESC" : "") %]
		<div>[% IF repos.size <= 1; "PLUGIN_EXTENSIONS_DESC" | string; END %]</div>
	[% END %]

	[% WRAPPER setting title="PLUGIN_EXTENSIONS_REPOS" desc="PLUGIN_EXTENSIONS_REPOS_DESC" %]
		<div>[% "PLUGIN_EXTENSIONS_REPOS_WARNING" | string %]</div>

		<div>
		[% FOREACH entry = repos %]
			<br/><input type="text" class="stdedit" name="repos" id="repos" value="[% entry %]" size="60" />
		[% END %]
		</div>
	[% END %]

	[% IF upgrade.size %]
		[% WRAPPER setting title="PLUGIN_EXTENSIONS_PLUGINS_UPGRADE" desc="" %]
		[%- END -%]

		[% WRAPPER pluginGroup %]
			[% FOREACH plugin = upgrade %]
				[% plugin.delta = BLOCK %][% plugin.current %] [% "TO" | string %] [% plugin.version %][% END %]
				[% PROCESS pluginDetails %]
			[% END %]
		[%- END -%]
	[%- END -%]

	[% IF remove.size %]

		[% WRAPPER setting title="PLUGIN_EXTENSIONS_PLUGINS_REMOVE" desc="" %]
		[%- END -%]

		<script TYPE="text/javascript">
			function toggleCheck(onOrOff) {
				var field = document.forms.settingsForm.remove;
				
				if (field && field.length == null) {
					if (field.checked != null)
						field.checked = onOrOff;
				}
				else {
					for (i = 0; i < field.length; i++)
						field[i].checked = onOrOff;
				}
			}
		</script>

		[% WRAPPER pluginGroup checkHeading="<input type=\"checkbox\" onclick=\"toggleCheck(this.checked)\"/>" %]
			[% FOREACH plugin = remove %]
				[% plugin.action = 'remove' %]
				[% PROCESS pluginDetails %]
			[% END %]
		[%- END -%]

	[%- END -%]

	[% IF install.size > 0 %]
		
		[% FOREACH repo = install %]
			[% WRAPPER setting title=repo.title desc="" %]
			[%- END -%]
	
			[% WRAPPER pluginGroup checkHeading="PLUGIN_EXTENSIONS_INSTALL" %]
				[% FOREACH plugin = repo.items %]
					[% plugin.changes = '' %]
					[% PROCESS pluginDetails type = repo.type %]
				[% END %]
			[%- END -%]
		
		[% END %]

	[%- END -%]

	[% IF manual.values.size %]
		[% type = undef %]

		[% WRAPPER setting title="PLUGIN_EXTENSIONS_PLUGIN_MANUAL" desc="" %]
		[%- END -%]

		[% WRAPPER pluginGroup %]
			[% FOREACH plugin = manual.values %]
				[% plugin.action = 'disabled' %]
				[% PROCESS pluginDetails %]
			[% END %]
		[%- END -%]

	[%- END -%]

	<input name="rand" type="hidden" value="[% rand %]" />

[% PROCESS settings/footer.html %]
