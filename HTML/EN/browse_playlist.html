[% pagetitle = "SAVED_PLAYLISTS" | string %]
[% pageicon = 'SAVED_PLAYLISTS' %]
[% IF levelName == 'album' || levelName == 'age' || levelName == 'playlisttrack'; titleRight = BLOCK %]
	<div id="viewSelect"></div>
[% END; END %]
[%- extJsScripts = BLOCK -%]
	<script type="text/javascript" src="[% webroot %]html/Browse.js?r=[% revision %]"></script>

	<script type="text/javascript">
		[% PROCESS jsString id='SWITCH_TO_LIST' jsId='switch_to_list' %]
		[% PROCESS jsString id='SWITCH_TO_EXTENDED_LIST' jsId='switch_to_extended_list' %]

		var orderByList;
	</script>
[% UNLESS noEdit %]
	<script type="text/javascript">
		Ext.onReady(function(){
			new SqueezeJS.UI.Sortable({
				el: 'browsedbList',
				selector: '#browsedbList div.draggableSong',
				onDropCmd: function(sourcePos, targetPos) {
					SqueezeJS.Controller.request({
						params: [ '', [
							'playlists',
							'edit',
							'playlist_id:' + [% playlist.id || 0 %],
							'cmd:move',
							'index:' + sourcePos,
							'toindex:' + targetPos
						]]
					});
				}
			})
		});
	</script>
[% END; END %]
[% IF NOT ajaxUpdate %][% PROCESS pageheader.html dontscroll=1 %]

	[% IF warn %][% PROCESS scanwarning %][% END %]

	[% IF warning %]<p><b>[% "NOTE" | string %]</b> [% warning | getstring %]<p><hr>[% END %]
	
	[% UNLESS noEdit %]
		<div class="playlistform">
			<form method="get" action="edit_playlist.html">
				<table>
					<tr>
						<td>[% "NAME" | string %] <input class="stdedit" name="newname" value="[% IF newname; newname; ELSE; playlist.title; END %]" size="[% maxInputSize ? maxInputSize : 40 %]"></td>
						<td><input class="stdclick" name="submit" type=submit value="[% "SAVE" | string %]" onclick='this.form.renamePlaylist.value=1'></td>
						<td><input class="stdclick" name="submit" type=submit value="[% "ADD" | string %]" onclick='this.form.addItem.value=1'></td>
						<td>
							[% IF playlist.title %]
								<input class="stdclick" type="submit" value="[% "DELETE" | string %]" onclick='this.form.deletePlaylist.value=1'>
							[% END %]
						</td>
					</tr>
					<tr>
						<td colspan="4">
							[%- IF warning == 'RENAME_WARNING' %]
								<input type="checkbox" name="overwrite">[% "CONFIRM_OVERWRITE" | string %]
							[%- END %]
							[%- IF warning == 'DELETE_WARNING' %]
								<input type="checkbox" name="confirm">[% "CONFIRM_DELETE" | string %]
							[%- END %]
							<input type="hidden" name="playlist.id" value="[% playlist.id %]">
							<input type="hidden" name="renamePlaylist" value="0">
							<input type="hidden" name="editPlaylist" value="0">
							<input type="hidden" name="deletePlaylist" value="0">
							<input type="hidden" name="addItem" value="0">
							<input type="hidden" name="player" value="[% player %]">
						</td>
					</tr>
				</table>
			</form>
		</div>
		[% rightcontrols = 'editcontrols'; leftcontrols = 'browsecontrols' %]

		[% BLOCK editcmd %]
				href="edit_playlist.html?player=[% playerURI %]&amp;[% cmd %]=1&amp;playlist.id=[% playlist.id %]&amp;itempos=[% start + loop.count - 1 %]&amp;start=[% start %]"
		[% END %]
		
		[% BLOCK editcontrols %]
			[% IF loop.count > 1 || loop.last %]
			[% UNLESS useExtJS %]
				[%- WRAPPER moveuplink noTarget=1 %]
					[%- PROCESS editcmd cmd='up' %]
				[% END %]

				[%- WRAPPER movedownlink noTarget=1 %]
					[%- PROCESS editcmd cmd='down' %]
				[% END %]
			[% END %]
			
			[%- WRAPPER editlink noTarget=1 %]
				[%- PROCESS editcmd cmd='edit' %]
			[% END %]
		
			[%- WRAPPER removelink noTarget=1 %]
				[%- PROCESS editcmd cmd='delete' %]
			[% END %]
			[% END %]
		[% END %]
	[% END %]

	<div id="browsedbHeader">
		[% IF hasPagebar %][% PROCESS pagebar %][% END %]
	</div>
	
[% END %]


[% BLOCK editform %]
	<form name="edit" action="[% webroot %]edit_playlist.html" style="display: inline; width: 100%;">
		<input type="hidden" name="player" value=[% playerURI %]>
		<input type="hidden" name="itempos" value=[% loop.index %]>				
		<input type="hidden" name="playlist.id" value=[% playlist.id %]>
		[%- IF item.itemobj.isRemoteURL %]<input style="display: inline; width: 35%;" type="text" class="stdedit" name="form_title" value="[% item.itemobj.title %]">[% END %]
		<input style="display: inline; width: 35%;" type="text" class="stdedit" name="form_url" value="[% item.itemobj.url %]">
		<input type="submit" style="display: inline; width: 10%;" class="stdclick" name="save" value=[% "SAVE" | string %]>
		<input type="submit" style="display: inline; width: 10%;" class="stdclick" name="cancel" value=[% "CANCEL" | string %]>
	</form>
[% END %]


[% WRAPPER contentcontainer %]
	[% IF addItem %]
		[% PROCESS editform %]
	[% END %]

	[% FOREACH item = browse_items %]
		[% addClasses = loop.index || loop.last ? 'draggableSong' : '' %]
		[% IF edit && loop.index == itempos %]
			[% PROCESS editform %]
		[% ELSE %]
			[% PROCESS browsedbitems_list.html %]
		[% END %]
	[% END %]
[% END %]

[% UNLESS ajaxUpdate %]
	[% UNLESS useExtJS %]
	<div id="browsedbHeader">
		[% IF hasPagebar %][% PROCESS pagebar %][% END %]
	</div>
	[% END %]
	[% PROCESS pagefooter.html %]
[% END %]
