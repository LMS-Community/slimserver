[%- pagetitle = browseby | string %]
[% IF levelName == 'album' || levelName == 'age'; titleRight = BLOCK %]
	<div id="viewSelect"></div>
[% END; END %]
[%- extJsScripts = BLOCK -%]
	<script type="text/javascript" src="[% webroot %]html/browse.js?r=[% revision %]"></script>

	<script type="text/javascript">
		[% PROCESS jsString id='SWITCH_TO_LIST' jsId='switch_to_list' %]
		[% PROCESS jsString id='SWITCH_TO_EXTENDED_LIST' jsId='switch_to_extended_list' %]
		[% PROCESS jsString id='SWITCH_TO_GALLERY' jsId='switch_to_gallery' %]
		[% PROCESS jsString id='SORT_BY' jsId='sort_by' %]
		[% PROCESS jsString id='ALBUM_DISPLAY_OPTIONS' jsId='display_options' %]

		var orderByList;
		[% IF levelName == 'album' %]
			orderByList = {
				'[% "ALBUM" | string %]'                : 'album.titlesort',
				'[% "SORT_YEARALBUM" | string %]'       : 'album.year,album.titlesort',
				'[% "SORT_YEARARTISTALBUM" | string %]' : 'album.year,contributor.namesort,album.titlesort',
				'[% "SORT_ARTISTALBUM" | string %]'     : 'contributor.namesort,album.titlesort',
				'[% "SORT_ARTISTYEARALBUM" | string %]' : 'contributor.namesort,album.year,album.titlesort',
				'[% "SORT_GENREALBUM" | string %]'      : 'genre.namesort,album.titlesort',
				'[% "SORT_GENREARTISTALBUM" | string %]': 'genre.namesort,contributor.namesort,album.titlesort'
			}
		[% END %]
	</script>
[%- END -%]
[%- PROCESS pageheader.html dontscroll=1 -%]

	<div id="browsedbHeader">
		[% IF !(artwork == 1 && (levelName == 'album' || levelName == 'age')) -%]
			[% IF hasPagebar %][% "ITEMS" | string %] [% pageinfo.startitem + 1 %] [% "TO" | string %] [% pageinfo.enditem + 1 %] [% "OF" | string %] [% pageinfo.totalitems %][% END %]
		[% END -%]
		[% IF warn -%]<p>[% PROCESS scanwarning %] [%- END %]

		[% IF hasPagebar -%]
			[% PROCESS pagebar %]
		[%- END %]
	</div>

	[%- IF artwork == 1 && (levelName == 'album' || levelName == 'age');
			container = 'gallerycontainer';
		ELSE;
			container = 'contentcontainer';
		END %]

	[%- IF song_count; infoTab = BLOCK -%]
		<div>[% album_count %] [% "WITH" | string %] [% song_count %] [% "BY" | string %] [% artist_count %].</div>
	[%- END; END -%]

	[%- WRAPPER $container %]

		[% IF levelName == 'track' && album.id %]
			[% 
				# remove "All Songs" item and display links at the top
				songInfoPlayLinks = BLOCK;
					PROCESS songInfoPlayLinks item = browse_items.shift();
				END;

				contributorRoles = {};

				IF !album.compilation;
					FOREACH contributor IN album.contributors;
						FOREACH contributor IN contributor.contributorRoles;
							contributorRoles.${contributor} = 1;
						END;
					END;
				END;

				PROCESS songinfo_details.html artAtTop = 1 headOnly = 1 itemobj = {
					id => coverArt,
					album => album,
					contributorRoles => contributorRoles.keys,
					genres => album.genre,
					year => album.year
				};
			%]

		[% ELSIF coverArt AND tree != 1 -%]

			<p><a [% coverArtHRef %] target="cover">[% PROCESS coverImg resize='1' %]</a></p>
		[% END -%]

		[% FOREACH item = browse_items -%]
			[%- PROCESS browsedbitems_list.html item.includeAlbum = 0 item.includeArtist = album.compilation -%]
		[%- END %]
	[% END -%]

[% PROCESS pagefooter.html %]
