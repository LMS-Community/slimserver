[%- BLOCK pluginLink -%]
	[% IF enabled && settings.length > 0 %]
		<a href="[% webroot %]settings/[% settings %]?player=[% playerURI %]&amp;playerid=[% playerURI %]&amp;noSettingsList=1">[% 'SETTINGS' | string %]</a>
	[% END %]
[%- END -%]
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>[% "SQUEEZECENTER" | string %]</title>

		<link rel="stylesheet" type="text/css" href="/html/ext/resources/css/ext-all.css" />
		<link rel="stylesheet" type="text/css" href="[% webroot %]slim-ext.css?r=[% revision %]" />
		<link rel="stylesheet" type="text/css" href="[% webroot %]slimserver.css?r=[% revision %]" />

		<script type="text/javascript" src="/html/ext/adapter/ext/ext-base.js?r=[% revision %]"></script>
		<script type="text/javascript" src="/html/ext/ext-all[% IF debug %]-debug[% END %].js?r=[% revision %]"></script>
		<script type="text/javascript">[% PROCESS html/vars.js %]</script>
 		<script type="text/javascript" src="/html/SqueezeJS/Base.js?r=[% revision %]"></script>
		<script type="text/javascript">[% PROCESS html/SqueezeJS/Strings.js %]</script>
		<script type="text/javascript" src="/html/SqueezeJS/UI.js?r=[% revision %]"></script>
		<script type="text/javascript" src="[% webroot %]html/Settings.js?r=[% revision %]"></script>

		<script type="text/javascript">
			[% PROCESS jsString id='BROWSE' jsId='' %]
			[% PROCESS jsString id='SETTINGS' jsId='' %]
			[% PROCESS jsString id='ADVANCED_SETTINGS' jsId='' %]
			[% PROCESS jsString id='SETUP_SELECT_FOLDER' jsId='choose_folder' %]
			[% PROCESS jsString id='SETUP_SELECT_FILE' jsId='choose_file' %]

			[% playerid = playerid || player %]
			// display player list if we're in the player settings
			[%-
			pageId = '^' _ page _ '$';
			pageLink = orderedLinks.grep(pageId);
			-%]

			// pages using the fileselector may set a filter (see iTunes)
			var fsFilter = new Array();

			Ext.onReady(function(){
				[% IF needsClient;
					USE Clients;
					players = Clients.get("id") %]

					Settings.Page.initPlayerList([
						[% FOREACH playerobj IN players -%]
							{
								id: "[% playerobj.id %]",
								name: "[% playerobj.name %]",
								current: "[% playerobj.id %]" == playerid || "[% playerobj.id %]" == player
							}[% loop.last ? '' : ',' %]
						[% END %]
					]);
	
					// remember the last loaded page - to be used when the player tab is selected next time
					try {
						parent.SqueezeJS.setCookie('SqueezeCenter-playersettings', '[% playersetup.$page || 'settings/player/basic.html?' %]');
						parent.player = '[% playerURI %]';
						parent.playerid = '[% playerURI %]';  
					}
					catch(e) {}
	
				[% END %]

				[% IF pageLink.size > 0 -%]
					Settings.Page.initSettingsList([
						[%- FOREACH link IN orderedLinks %]
							{ 
								id: "[% link %]",
								current: [% page == link ? 'true' : 'false' %],
								url: "[% needsClient ? playersetup.$link : additionalLinks.setup.$link %]",
								name: "[% link | string %]"
							}[% loop.last ? '' : ',' %]
						[% END %]
					]);

					[% IF !needsClient %]
						try { parent.SqueezeJS.setCookie('SqueezeCenter-advancedsettings', '[% additionalLinks.setup.$page %]'); }
						catch(e) {}
					[% END %]
				[%- END -%]

				Settings.Page.init();

				var el;
				[%- FOREACH pref = validate; IF pref.value %]
					if (el = Ext.get('[% pref.key %]')) {
						el.on('blur', function(){ Settings.Page.validatePref('[% pref.key %]', '[% namespace %]'); } );
						el.addClass('canValidate');
					}
				[%- END; END %]
			});
		</script>

		[% IF pageHeaderScripts && NOT extJsScripts %]
			[% pageHeaderScripts %]
		[% ELSE %]
			[% extJsScripts %]
		[% END %]

		<style>
			html {
				overflow: auto;
				background-color: white;
			}

		[%- IF debug %]
			.x-layout-panel-body { background: white; }
			.x-btn-text, .x-btn button { color: black; }
			.x-dlg .x-tabs-bottom .x-tabs-body {
				background: white;
				color: black;
			}
		[%- END %]
		</style>

		<!--[if lte IE 6]>
		<link href="[% webroot %]ie.css?r=[% revision %]" type="text/css" rel="stylesheet">
		<![endif]-->
		<!--[if IE 7]>
		<link href="[% webroot %]ie7.css?r=[% revision %]" type="text/css" rel="stylesheet">
		<![endif]-->
	</head>

	<body class="[% bodyClass || "settings" %]">

		[% IF needsClient || (pageLink.size > 0 && !noSettingsList) %]
		<div class="buttonbar" id="toolbar">
			<table>
				<tr>
					[%- IF needsClient %]
						<td><span id="playerSelector"></span></td>
					[% END %]
					[%- IF !noSettingsList %]
						<td><span id="settingsSelector"></span></td>
					[% END %]
				<tr>
			</table>
		</div>
		[% END -%]

		<div id="content" class="scrollingPanel">

			[% IF warning %]
				<div id="statusarea" class="statusarea">
					[% warning %]
					&nbsp;
				</div>
			[% END %]

			<form name="settingsForm" id="settingsForm" method="post" action="[% webroot %][% path %][% IF playerid %]?playerid=[% playerid | uri %][% END %]">

			<div id="settingsRegion">

				<input type=hidden value="1" name="saveSettings">
				<input type=hidden value="0" name="useAJAX">
				<input type=hidden value="[% page %]" name="page">
				[% IF playerid %]<input type=hidden value="[% playerid %]" name="playerid">[% END %]
				[% IF player %]<input type=hidden value="[% player %]" name="player">[% END %]
