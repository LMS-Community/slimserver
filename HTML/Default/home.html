[% IF page == 'help';
	
	pagetitle = "HELP" | string;
	
	PROCESS helpheader.html noCrumbList=1;
	
	WRAPPER helpTopicList;
		"<br/><br/>";
		FOREACH link = additionalLinks.help;
			title = link.key | string | html;
			href = link.value;
			PROCESS helpTopic;
		END;
	END;
	
	PROCESS helpfooter.html;

ELSE %]
	[% extJsScripts = BLOCK %]
		<script type="text/javascript" src="[% webroot %]html/Home.js?r=[% revision %]"></script>
		<script type="text/javascript">
			Ext.onReady(function(){
				Home.init();
			});
		</script>
	[% END %]

	[%
	my_musicItems = BLOCK;
		orderedLinks = ['BROWSE_BY_ARTIST', 'BROWSE_BY_ALBUM', 'BROWSE_BY_GENRE', 'BROWSE_BY_YEAR', 'BROWSE_NEW_MUSIC', 'PLUGIN_RANDOMPLAY'];
		FOREACH item = orderedLinks;
			IF additionalLinks.browse.exists(item);
				link = { key=item, value=additionalLinks.browse.$item };
				PROCESS menuItem;
			END;
		END;
		FOREACH link = additionalLinks.browse;
			IF link.key != 'FAVORITES' && !orderedLinks.grep(link.key).size;
				additionalLinks.icons.${link.key} = additionalLinks.icons.${link.key} || 'html/images/plugin.png';
				PROCESS menuItem;
			ELSIF link.key == 'FAVORITES';
				useFavorites = 1;
			END;
		END;
		FOREACH link = additionalLinks.search;
			IF link.key == 'SEARCHMUSIC';
				control = BLOCK %]
					<form method="GET" action="[% webroot %]search.html">
						<input type="hidden" name="manualSearch" value="1"/>
						<input type="hidden" name="livesearch" value="0"/>
						<input type="hidden" name="player" value="[% playerid %]">
						<input type="text" name="query" id="search" class="x-form-focus searchInput" size="30">
						<input type="image" src="[% webroot %]html/images/b_search.gif" width="17px" height="17px" alt="[% "SEARCH" | string %]">
					</form>
				[% END;
				PROCESS menuItem;
			END;
		END;
	END;
	
	radioItems = BLOCK;
		FOREACH item = additionalLinkOrder.radios;
			IF additionalLinks.radios.exists(item);
				link.value = additionalLinks.radios.$item;
				link.key = item;
				PROCESS menuItem;
			END;
		END;
		FOREACH link = additionalLinks.radios;
			IF !additionalLinkOrder.radios.grep(link.key).size;
				additionalLinks.icons.${link.key} = additionalLinks.icons.${link.key} || 'html/images/plugin.png';
				PROCESS menuItem;
			END;
		END;
		additionalLinks.icons.RADIO_TUNEIN = 'html/images/ServiceProviders/tuneinurl.png';
		control = BLOCK %]
			<input type="text" id="tuneinurl" class="x-form-focus" size="30" value="http://" onfocus="this.select();">
			[% WRAPPER playlink %]onclick="Home.tuneInUrl('play');"[% END %]
			[% WRAPPER addlink %]onclick="Home.tuneInUrl('add');"[% END %]
		[% END;
		PROCESS menuItem link={ key='RADIO_TUNEIN', value='tunein.html?' };
	END;

	music_servicesItems = BLOCK;
		FOREACH item = additionalLinkOrder.music_services;
			IF additionalLinks.music_services.exists(item);
				link.value = additionalLinks.music_services.$item;
				link.key = item;
				PROCESS menuItem;
			END;
		END;
		FOREACH link = additionalLinks.music_services;
			IF !additionalLinkOrder.music_services.grep(link.key).size;
				additionalLinks.icons.${link.key} = additionalLinks.icons.${link.key} || 'html/images/plugin.png';
				PROCESS menuItem;
			END;
		END;
		IF additionalLinks.radios.exists('PLUGIN_PANDORA_MODULE_NAME');
			PROCESS menuItem link={ key='PLUGIN_PANDORA_MODULE_NAME', value=additionalLinks.radios.PLUGIN_PANDORA_MODULE_NAME };
		END;
	END;

	pluginsItems = BLOCK;
		FOREACH link = additionalLinks.plugins;
			IF link.key == 'ALARM';
				NEXT UNLESS player;
				link.value = webroot _ 'settings/index.html?activePage=ALARM&amp;';
				link.target = 'sc_settings';
			END;
			IF link.key == 'PLUGIN_LINE_IN';
				link.value = 'PLUGIN_LINE_IN_IN_USE' | getstring;
				link.value = "javascript:Home.setLineIn('" _ link.value _"');\" \"";
			END;
			# we want an icon for every item in the Extras menu...
			additionalLinks.icons.${link.key} = additionalLinks.icons.${link.key} || 'html/images/plugin.png';
			PROCESS menuItem;
		END;
	END %]

	[% BLOCK menuItem %]
		<div class="selectorMarker [% expandable %]" onmouseover="Highlighter.highlight(this [% IF expandable %], Home.onSelectorClicked[% END %]);">
			<div class="selector_topRight"><div class="selector_topLeft"><div class="selector_bottomRight"><div class="selector_bottomLeft">
				<div class="homeMenuItem" id="[% link.key %]">
					[% IF expandable %]
						<img class="disclosure_home" src="[% webroot %]html/images/spacer.gif"/>
					[% ELSE %]
						<a href="[% link.value %]player=[% player %]" class="browseItemLink" [% IF link.target; 'target="' _ link.target _ '"'; END %]>
					[% END %]

					[% IF (additionalLinks.icons.${link.key} || link.icon) && !noIcon;
						link.icon = additionalLinks.icons.${link.key} || link.icon;

						# have local artwork resized
						UNLESS link.icon.match('^http:');
							link.icon = webroot _ link.icon.replace('.png', "_25x25_f.png");
						END
					%]
						<span class="browseCover">
							<img src="[% link.icon %]" width="25" border="0" alt="[% link.key | getstring %]">
						</span>
						<div class="smallBrowseItemDetail">
					[% END %]
					[% IF dontGetString; link.key; ELSE; link.key | getstring; END %]
					[% IF link.icon && !noIcon %]
						</div>
					[% END %]

					[% IF !expandable %]
						</a>
					[% END %]
	
					[% IF control %]
						<span class="browsedbControls">
							[% control %]
						</span>					
					[% END %]
				</div>
			</div>
		</div></div></div></div>
	[% control=''; END %]

	[% pagetitle = "HOME" | string %]
	[% menu = BLOCK %]
	<div class="homeMenuSection" id="homeMenu">
		[% PROCESS menuItem link.key="MY_MUSIC" link.value="home.html?" expandable="my_music" noIcon=1 %]
		<div id="MY_MUSIC_expanded" class="expandableHomeMenuItem">[%- my_musicItems -%]</div>
	
		[% IF additionalLinks.radios %]
			[% PROCESS menuItem link.key="RADIO" link.value="home.html?" expandable="radio" noIcon=1 %]
			<div id="RADIO_expanded" class="expandableHomeMenuItem">[%- radioItems -%]</div>
		[% END %]
	
		[% IF additionalLinks.music_services %]
			[% PROCESS menuItem link.key="MUSIC_SERVICES" link.value="home.html?" expandable="music_services" noIcon=1 %]
			<div id="MUSIC_SERVICES_expanded" class="expandableHomeMenuItem">[%- music_servicesItems -%]</div>
		[% END %]

		[% IF favorites;
			control = BLOCK; 
				WRAPPER editlink noTarget=1;
					'href="' _ webroot _ 'plugins/Favorites/index.html?fav"';
				END;
			END;

			PROCESS menuItem expandable=1 noIcon=1
				link = { 
					key = 'FAVORITES',
					value = additionalLinks.browse.FAVORITES
				} 
			%]
			<div id="FAVORITES_expanded" class="expandableHomeMenuItem">
			[% 
				expandable = 0;
				dontGetString = 1;
				FOREACH entry = favorites;
					control = BLOCK;
						IF entry.type == "audio";
							WRAPPER playlink noTarget=1 -%]
								href="javascript:void(0);" onClick="SqueezeJS.UI.setProgressCursor();SqueezeJS.Controller.urlRequest('[% webroot %]plugins/Favorites/index.html?action=play&amp;index=[% loop.index %]&amp;player=[% player | uri %]', true, SqueezeJS.string('connecting_for'));"
							[%- END;
							WRAPPER addlink noTarget=1 -%]
								href="javascript:void(0);" onClick="SqueezeJS.UI.setProgressCursor();SqueezeJS.Controller.urlRequest('[% webroot %]plugins/Favorites/index.html?action=add&amp;index=[% loop.index %]&amp;player=[% player | uri %]', true, SqueezeJS.string('connecting_for'));"
							[%- END;
						ELSE;
							PROCESS dummylink;
							PROCESS dummylink;
						END;
					END;

					PROCESS menuItem noIcon=!entry.icon
						link = {
							icon = entry.icon,
							key = entry.text,
							value = webroot _ "plugins/Favorites/index.html?sess=1&amp;index=" _ loop.index _ "&amp;player=" _ playerURI
						};
				END;
				noIcon=1
				dontGetString = 0;
			%]
			</div>
		[% END %]

		[% IF additionalLinks.plugins %]
			[% PROCESS menuItem link.key="PLUGINS" link.value="home.html?" expandable="plugins"; expandable = 0 %]
			<div id="PLUGINS_expanded" class="expandableHomeMenuItem">[%- pluginsItems -%]</div>
		[% END %]
	</div>
	[% END %]

	[% PROCESS pageheader.html noHomeLink=1 %]

	[% menu %]

	[% IF NOT warn AND (album_count OR artistcount OR song_count) %]
		[% infoTab = BLOCK %]
			<span id="albumcount">[% album_count %]</span> [% "WITH" | string -%]
			<span id="songcount">[%- song_count %]</span> [% "BY" | string -%]
			<span id="artistcount">[% artist_count %]</span>.
		[% END %]
	[% END %]

	[% PROCESS pagefooter.html %]
[% END %]
