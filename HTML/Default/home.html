[% IF page == 'help';
	
	pagetitle = "HELP" | string;
	
	PROCESS helpheader.html noCrumbList=1;
	
	WRAPPER helpTopicList;
		"<br/><br/>";
		FOREACH link = additionalLinks.help;
			title = link.key | string | html;
			href = link.value;
			PROCESS helpTopic;
		END;
	END;
	
	PROCESS helpfooter.html;

ELSE %]
	[% extJsScripts = BLOCK %]
		<script type="text/javascript" src="[% webroot %]html/home.js?r=[% revision %]"></script>
	
		<script type="text/javascript">
			Ext.EventManager.onDocumentReady(MainMenu.init, MainMenu, true);
		</script>
	[% END %]

	[%
	my_musicItems = BLOCK;
		orderedLinks = ['BROWSE_BY_ARTIST', 'BROWSE_BY_ALBUM', 'BROWSE_BY_GENRE', 'BROWSE_BY_YEAR', 'BROWSE_NEW_MUSIC', 'PLUGIN_RANDOMPLAY'];
		FOREACH item = orderedLinks;
			IF additionalLinks.browse.exists(item);
				link = { key=item, value=additionalLinks.browse.$item };
				PROCESS menuItem;
			END;
		END;
		FOREACH link = additionalLinks.browse;
			IF link.key != 'FAVORITES' && !orderedLinks.grep(link.key).size;
				PROCESS menuItem;
			ELSIF link.key == 'FAVORITES';
				useFavorites = 1;
			END;
		END;
		FOREACH link = additionalLinks.search;
			IF link.key == 'SEARCHMUSIC';
				control = BLOCK %]
					<form method="GET" action="[% webroot %]search.html">
						<input type="hidden" name="manualSearch" value="1"/>
						<input type="hidden" name="livesearch" value="0"/>
						<input type="hidden" name="player" value="[% playerid %]">
						<input type="text" name="query" id="search" class="x-form-focus searchInput" size="30">
						<input type="image" src="[% webroot %]html/images/b_search.gif" width="17px" height="17px" alt="[% "SEARCH" | string %]">
					</form>
				[% END;
				PROCESS menuItem;
			END;
		END;
	END;
	
	radioItems = BLOCK;
		FOREACH item = additionalLinkOrder.radios;
			IF additionalLinks.radios.exists(item);
				link.value = additionalLinks.radios.$item;
				link.key = item;
				PROCESS menuItem;
			END;
		END;
		FOREACH link = additionalLinks.radios;
			IF !additionalLinkOrder.radios.grep(link.key).size;
				PROCESS menuItem;
			END;
		END;
		additionalLinks.icons.RADIO_TUNEIN = 'html/images/ServiceProviders/tuneinurl.png';
		control = BLOCK %]
			<input type="text" id="tuneinurl" class="x-form-focus" size="30" value="http://" onfocus="this.select();">
			[% WRAPPER playlink %]onclick="Utils.processPlayerCommand({ params: ['playlist', 'play', Ext.get('tuneinurl').dom.value] });"[% END %]
			[% WRAPPER addlink %]onclick="Utils.processPlayerCommand({ params: ['playlist', 'add', Ext.get('tuneinurl').dom.value] });"[% END %]
		[% END;
		PROCESS menuItem link={ key='RADIO_TUNEIN', value='tunein.html?' };
	END;

	music_servicesItems = BLOCK;
		FOREACH item = additionalLinkOrder.music_services;
			IF additionalLinks.music_services.exists(item);
				link.value = additionalLinks.music_services.$item;
				link.key = item;
				PROCESS menuItem;
			END;
		END;
		FOREACH link = additionalLinks.music_services;
			IF !additionalLinkOrder.music_services.grep(link.key).size;
				PROCESS menuItem;
			END;
		END;
		IF additionalLinks.radios.exists('PLUGIN_PANDORA_MODULE_NAME');
			PROCESS menuItem link={ key='PLUGIN_PANDORA_MODULE_NAME', value=additionalLinks.radios.PLUGIN_PANDORA_MODULE_NAME };
		END;
	END;

	pluginsItems = BLOCK;
		FOREACH link = additionalLinks.plugins;
			PROCESS menuItem;
		END;
	END %]

	[% BLOCK menuItem %]
		<div class="selectorMarker [% expandable %]" onmouseover="Utils.highlight(this [% IF expandable %], MainMenu.onSelectorClicked[% END %]);">
			<div class="selector_topRight"><div class="selector_topLeft"><div class="selector_bottomRight"><div class="selector_bottomLeft">
				<div class="homeMenuItem" id="[% link.key %]">
					[% IF expandable %]
						<img class="disclosure_home" src="[% webroot %]html/images/spacer.gif"/>
					[% ELSE %]
						<a href="[% link.value %]player=[% player %]" class="browseItemLink">
					[% END %]
						[% IF additionalLinks.icons.${link.key} %]
							<span class="browseCover">
								<img src="[% webroot %][% additionalLinks.icons.${link.key}.replace('.png', "_25x25_f.png") %]" width="25" border="0" alt="[% link.key | string %]">
							</span>
							<div class="smallBrowseItemDetail">
						[% END %]
						[% link.key | getstring %]
						[% IF additionalLinks.icons.${link.key} %]
							</div>
						[% END %]
					[% IF !expandable %]
						</a>
					[% END %]
	
					[% IF control %]
						<span class="browsedbControls">
							[% control %]
						</span>					
					[% END %]
				</div>
			</div>
		</div></div></div></div>
	[% control=''; END %]

	[% pagetitle = "HOME" | string %]
	[% menu = BLOCK %]
	<div class="homeMenuSection" id="homeMenu">
		[% PROCESS menuItem link.key="MY_MUSIC" link.value="home.html?" expandable="my_music" %]
		<div id="MY_MUSIC_expanded" class="expandableHomeMenuItem">[%- my_musicItems -%]</div>
	
		[% IF additionalLinks.radios %]
			[% PROCESS menuItem link.key="RADIO" link.value="home.html?" expandable="radio" %]
			<div id="RADIO_expanded" class="expandableHomeMenuItem">[%- radioItems -%]</div>
		[% END %]
	
		[% IF additionalLinks.music_services %]
			[% PROCESS menuItem link.key="MUSIC_SERVICES" link.value="home.html?" expandable="music_services" %]
			<div id="MUSIC_SERVICES_expanded" class="expandableHomeMenuItem">[%- music_servicesItems -%]</div>
		[% END %]

		[% IF favorites;
			control = BLOCK; 
				WRAPPER editlink noTarget=1;
					'href="' _ webroot _ 'plugins/Favorites/index.html?fav"';
				END;
			END;

			PROCESS menuItem expandable=1 
				link = { 
					key = 'FAVORITES',
					value = additionalLinks.browse.FAVORITES
				} 
			%]
			<div id="FAVORITES_expanded" class="expandableHomeMenuItem">
			[% 
				expandable = 0;
				FOREACH entry = favorites;
					control = BLOCK;
						IF entry.type == "audio";
							 WRAPPER playlink noTarget=1 -%]
								href="javascript:void(0);" onClick="Utils.processCommandURL('[% webroot %]plugins/Favorites/index.html?action=play&amp;index=[% loop.index %]&amp;player=[% player | uri %]');"
							[%- END;
							WRAPPER addlink noTarget=1 -%]
								href="javascript:void(0);" onClick="Utils.processCommandURL('[% webroot %]plugins/Favorites/index.html?action=add&amp;index=[% loop.index %]&amp;player=[% player | uri %]');"
							[%- END;
						ELSE;
							PROCESS dummylink;
							PROCESS dummylink;
						END;
					END;

					PROCESS menuItem 
						link = {
							key = entry.text,
							value = webroot _ "plugins/Favorites/index.html?&amp;index=" _ loop.index _ "&amp;player=" _ playerURI
						};
				END
			%]
			</div>
		[% END %]

		[% IF additionalLinks.plugins %]
			[% PROCESS menuItem link.key="PLUGINS" link.value="home.html?" expandable="plugins"; expandable = 0 %]
			<div id="PLUGINS_expanded" class="expandableHomeMenuItem">[%- pluginsItems -%]</div>
		[% END %]
	</div>
	[% END %]

	[% PROCESS pageheader.html noHomeLink=1 %]

	[% menu %]

	[% IF NOT warn AND (album_count OR artistcount OR song_count) %]
		[% infoTab = BLOCK %]
			<span id="albumcount">[% album_count %]</span> [% "WITH" | string -%]
			<span id="songcount">[%- song_count %]</span> [% "BY" | string -%]
			<span id="artistcount">[% artist_count %]</span>.
		[% END %]
	[% END %]

	[% PROCESS pagefooter.html %]
[% END %]
